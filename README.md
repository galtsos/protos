# Proto buffers

Все .proto файлы, используемые нашими приложениями.

## Структура

Имена `message`, `service` и прочих сущностей должны быть уникальными среди всех `.proto`-файлов в любых директориях репозитория. Это обусловлено тем, что генератор кода `grpc_tools.protoc` будет ругаться на конфликт имён, если при импорте сущностей в `.proto`-файле появятся дубликаты.

Имя директории - это имя веб-сервиса. При этом конечное приложение, использующее сгенерированный код, может реализовывать API одновременно нескольких веб-сервисов.

Сущности `service` должны определяться в файле с именем `api.proto`. Имена этих сущностей должны иметь формат `<ИмяВебСервиса>Api`. Данный суффикс позволяет устранить возможный конфликт одинаковых названий `service` и `message`. Кроме этого в файле `api.proto` могут объявляться только те `message`, которые необходимы лишь для описания входящих и исходящих сообщений для определенных в нём `service`.

Сущности `message`, которые не являются входящими и исходящими сообщения для `service`, должны определяться в файле с именем `entities.proto`.

## Процесс выпуска новой версии и использования её в приложении

1. Согласование и проектирование изменений
1. Внесение изменений в `.proto`-файлы через ветку и приёмку пул реквеста
1. Слияние ветки с master в случае успешной проверки изменений через автоматические средства
1. Автоматическая генерация файлов клиента и сервера gRPC для целевых языков программирования с использованием хеша коммита слияния как версии для совокупности `.proto`-файлов и файлов клиента и сервера
1. Публикация новой версии клиента и сервера в системы зависимостей для целевых языков программирования (pypi, composer, etc)
1. Указание нужной версии клиента/сервера в зависимом приложении
1. Скачивание указанной версии клиента/сервера в момент сборки контейнера зависимого приложения
