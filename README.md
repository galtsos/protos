# Proto buffers

Все .proto файлы, используемые нашими модулями.

## Структура

Имя директории - это имя модуля. Это даёт возможность использовать одинаковые имена `message` в разных модулях. При этом структура этих `message` может отличаться, т.к. у модулей может быть разная интерпретация данных терминов и разные требования к функциональности с этими message.

Сущности `service` должны определяться в файле с именем `api.proto`. Имена этих сущностей должны иметь формат `<ИмяМодуля>Api`. Данный суффикс позволяет устранить возможный конфликт одинаковых названий `service` и `message`. Также файле `api.proto` должны находиться только те `message`, которые необходимы лишь для описания входящих и исходящих сообщений для определенных в нём `service`.

Сущности `message`, которые не являются входящими и исходящими сообщения для `service`, должны определяться в файле с именем `entities.proto`.

## Процесс выпуска новой версии и использования её в приложении

1. Согласование и проектирование изменений
1. Внесение изменений в `.proto`-файлы через ветку и приёмку пул реквеста
1. Слияние ветки с master в случае успешной проверки изменений через автоматические средства
1. Автоматическая генерация файлов клиента и сервера gRPC для целевых языков программирования с использованием хеша коммита слияния как версии для совокупности `.proto`-файлов и файлов клиента и сервера
1. Публикация новой версии клиента и сервера в системы зависимостей для целевых языков программирования (pypi, composer, etc)
1. Указание нужной версии клиента/сервера в зависимом приложении
1. Скачивание указанной версии клиента/сервера в момент сборки контейнера зависимого приложения
